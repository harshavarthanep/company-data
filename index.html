<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PMO Enterprise Analyzer v3.0</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        corp: { 50: '#f8fafc', 800: '#1e293b', 900: '#0f172a' },
                        brand: { 500: '#3b82f6', 600: '#2563eb' }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; color: #1e293b; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px); border: 1px solid #e2e8f0; }
        .nav-item.active { background-color: #eff6ff; color: #2563eb; border-left: 4px solid #2563eb; }
        .hide { display: none !important; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden bg-slate-50">

    <aside class="w-64 bg-white border-r border-gray-200 hidden md:flex flex-col z-10">
        <div class="p-6">
            <h1 class="text-xl font-bold tracking-tight text-corp-900">PMO<span class="text-brand-600">Enterprise</span></h1>
            <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-widest">Analyst Suite v3.0</p>
        </div>
        <nav class="flex-1 overflow-y-auto py-2">
            <a onclick="nav('dashboard')" id="link-dashboard" class="nav-item active flex items-center px-6 py-3.5 text-sm font-medium cursor-pointer text-gray-600 hover:bg-gray-50"><i class="fas fa-th-large w-6"></i> Dashboard</a>
            <a onclick="nav('analyze')" id="link-analyze" class="nav-item flex items-center px-6 py-3.5 text-sm font-medium cursor-pointer text-gray-600 hover:bg-gray-50"><i class="fas fa-search w-6"></i> New Analysis</a>
            <a onclick="nav('import')" id="link-import" class="nav-item flex items-center px-6 py-3.5 text-sm font-medium cursor-pointer text-gray-600 hover:bg-gray-50"><i class="fas fa-file-import w-6"></i> Smart Import</a>
        </nav>
        <div class="p-6 border-t border-gray-100 bg-gray-50">
             <button onclick="backupData()" class="w-full text-xs bg-white border border-gray-300 text-gray-700 py-2 rounded shadow-sm hover:bg-gray-100">Backup JSON</button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full overflow-hidden relative w-full">
        
        <header class="md:hidden h-14 bg-white border-b flex items-center justify-between px-4">
            <div class="font-bold text-corp-900">PMO<span class="text-brand-600">Ent</span></div>
            <div class="flex gap-4 text-gray-600">
                <i class="fas fa-th-large" onclick="nav('dashboard')"></i>
                <i class="fas fa-plus-circle" onclick="nav('analyze')"></i>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-4 md:p-8" id="main-scroll">
            
            <div id="view-dashboard" class="space-y-6 max-w-7xl mx-auto">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">Corporate Registry</h2>
                    <span class="text-xs bg-brand-100 text-brand-700 px-3 py-1 rounded-full" id="db-status">Loading...</span>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <table class="w-full text-sm text-left whitespace-nowrap">
                        <thead class="bg-gray-50 text-gray-500 border-b">
                            <tr>
                                <th class="px-6 py-3">Company</th>
                                <th class="px-6 py-3">Industry</th>
                                <th class="px-6 py-3">Revenue/Val</th>
                                <th class="px-6 py-3 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="view-import" class="hide max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="font-bold text-gray-800 mb-2 flex items-center"><i class="fas fa-magic text-purple-600 mr-2"></i> Smart Document Parser</h3>
                    <p class="text-sm text-gray-500 mb-4">Paste the full text from your Word/PDF document here. The system will attempt to extract structured data.</p>
                    <textarea id="import-text" rows="10" class="w-full p-4 border border-gray-300 rounded-lg text-xs font-mono bg-slate-50 focus:bg-white" placeholder="Paste document content here..."></textarea>
                    <div class="mt-4 flex justify-end">
                        <button onclick="parseDocument()" class="bg-purple-600 text-white px-6 py-2 rounded shadow hover:bg-purple-700 font-medium">Parse & Create Record</button>
                    </div>
                </div>
            </div>

            <div id="view-analyze" class="hide max-w-5xl mx-auto pb-20">
                <form id="main-form" class="space-y-6">
                    <input type="hidden" id="entry-id">
                    
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <h4 class="font-bold text-gray-800 mb-4 border-b pb-2">1. Corporate Overview</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                            <div class="md:col-span-1">
                                <label class="lbl">Company Name</label>
                                <input type="text" id="inp-name" required class="inp">
                            </div>
                            <div>
                                <label class="lbl">Industry / Sector</label>
                                <input type="text" id="inp-industry" class="inp">
                            </div>
                             <div>
                                <label class="lbl">Website</label>
                                <input type="text" id="inp-web" class="inp">
                            </div>
                            <div>
                                <label class="lbl">Headquarters</label>
                                <input type="text" id="inp-hq" class="inp">
                            </div>
                            <div>
                                <label class="lbl">Revenue / Valuation</label>
                                <input type="text" id="inp-rev" class="inp" placeholder="$500M">
                            </div>
                            <div>
                                <label class="lbl">CEO / Leadership</label>
                                <input type="text" id="inp-ceo" class="inp">
                            </div>
                            <div class="md:col-span-3">
                                <label class="lbl">Company Description (About)</label>
                                <textarea id="inp-desc" rows="3" class="inp"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <h4 class="font-bold text-gray-800 mb-4 border-b pb-2">2. Products & Technology</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="lbl">Product Portfolio (List)</label>
                                <textarea id="inp-products" rows="4" class="inp" placeholder="- Product A&#10;- Product B"></textarea>
                            </div>
                            <div>
                                <label class="lbl">Technology Stack</label>
                                <textarea id="inp-tech" rows="4" class="inp" placeholder="AI Platforms, Cloud Infrastructure, etc."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <h4 class="font-bold text-gray-800 mb-4 border-b pb-2">3. Business Ecosystem</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="lbl">Key Acquisitions</label>
                                <textarea id="inp-acq" rows="3" class="inp" placeholder="Company X (2020), Company Y (2021)"></textarea>
                            </div>
                            <div>
                                <label class="lbl">Strategic Partnerships</label>
                                <textarea id="inp-partners" rows="3" class="inp" placeholder="T-Mobile, Samsung, Google"></textarea>
                            </div>
                            <div>
                                <label class="lbl">Direct Competitors</label>
                                <textarea id="inp-comp-direct" rows="3" class="inp" placeholder="AppLovin, ironSource"></textarea>
                            </div>
                             <div>
                                <label class="lbl">Indirect Competitors</label>
                                <textarea id="inp-comp-indirect" rows="3" class="inp" placeholder="Google Play, Apple App Store"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <h4 class="font-bold text-gray-800 mb-4 border-b pb-2">4. History & Operations</h4>
                        <div class="grid grid-cols-1 gap-5">
                            <div>
                                <label class="lbl">Key Milestones / History (Year - Event)</label>
                                <textarea id="inp-history" rows="5" class="inp font-mono text-xs" placeholder="1998 - Founded&#10;2014 - Rebranded"></textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                <div>
                                    <label class="lbl">Job Openings / Hiring Focus</label>
                                    <textarea id="inp-jobs" rows="3" class="inp"></textarea>
                                </div>
                                <div>
                                    <label class="lbl">Upcoming Events / Earnings</label>
                                    <textarea id="inp-events" rows="3" class="inp"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-end gap-3 sticky bottom-4 bg-white p-4 rounded-xl shadow-xl border border-gray-100 z-20">
                        <button type="button" onclick="nav('dashboard')" class="px-5 py-2 text-sm text-gray-500 hover:text-gray-800">Cancel</button>
                        <button type="submit" class="bg-corp-900 text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:bg-gray-800 flex items-center">
                            <i class="fas fa-save mr-2"></i> Save Full Record
                        </button>
                    </div>
                </form>
            </div>

        </div>
    </main>

    <style>
        .lbl { display: block; font-size: 0.75rem; font-weight: 600; color: #64748b; margin-bottom: 0.25rem; text-transform: uppercase; }
        .inp { width: 100%; padding: 0.5rem; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.375rem; font-size: 0.875rem; outline: none; transition: all 0.2s; }
        .inp:focus { background-color: #ffffff; border-color: #3b82f6; ring: 2px; }
    </style>

    <script>
        // --- DATA LAYER ---
        let db = JSON.parse(localStorage.getItem('pmo_ent_db')) || [];

        // --- INIT ---
        window.onload = () => {
            renderTable();
            document.getElementById('db-status').innerText = `${db.length} Records`;
        };

        // --- NAVIGATION ---
        function nav(viewId) {
            document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hide'));
            document.getElementById(`view-${viewId}`).classList.remove('hide');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const link = document.getElementById(`link-${viewId}`);
            if(link) link.classList.add('active');
        }

        // --- PARSER ENGINE (The Logic for your Document) ---
        function parseDocument() {
            const text = document.getElementById('import-text').value;
            if(!text) return alert("Paste text first!");

            // Regex Patterns based on your document structure
            const extract = (pattern) => {
                const match = text.match(pattern);
                return match ? match[1].trim() : "";
            };

            // Basic extraction logic
            const name = extract(/Company Name:\s*(.+)/i) || "New Company";
            const industry = extract(/Industry Served:\s*(.+)/i);
            const web = extract(/Website:\s*(.+)/i);
            const revenue = extract(/Revenue:\s*(.+)/i);
            const hq = extract(/Headquarters[\s\S]*?Address:\s*(.+)/i);
            const ceo = extract(/CEO:\s*(.+)/i) || extract(/Bill Stone/i) ? "Bill Stone" : ""; // Specific fallbacks
            
            // Block extraction (About, Products, etc)
            const getBlock = (startKey, endKey) => {
                const s = text.indexOf(startKey);
                if(s === -1) return "";
                const e = endKey ? text.indexOf(endKey, s) : text.length;
                return text.substring(s + startKey.length, e).trim();
            }

            // Populate Form
            document.getElementById('inp-name').value = name;
            document.getElementById('inp-industry').value = industry;
            document.getElementById('inp-web').value = web;
            document.getElementById('inp-rev').value = revenue;
            document.getElementById('inp-hq').value = hq;
            document.getElementById('inp-ceo').value = ceo;
            document.getElementById('inp-desc').value = getBlock("About Digital Turbine", "Founding & Corporate Background");
            document.getElementById('inp-products').value = getBlock("Product Portfolio", "Company History");
            document.getElementById('inp-acq').value = getBlock("Acquired Companies", "Market Position");
            document.getElementById('inp-partners').value = getBlock("Key Partnerships", "Technology Stack");
            document.getElementById('inp-history').value = getBlock("Company History & Key Milestones", "Partnerships");
            
            // Switch to form
            nav('analyze');
            alert("Parsing Complete. Please review and fill missing fields.");
        }

        // --- CRUD ---
        document.getElementById('main-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const getVal = (id) => document.getElementById(id).value;
            
            const record = {
                id: document.getElementById('entry-id').value || Date.now().toString(),
                name: getVal('inp-name'),
                industry: getVal('inp-industry'),
                website: getVal('inp-web'),
                hq: getVal('inp-hq'),
                revenue: getVal('inp-rev'),
                ceo: getVal('inp-ceo'),
                desc: getVal('inp-desc'),
                products: getVal('inp-products'),
                tech: getVal('inp-tech'),
                acq: getVal('inp-acq'),
                partners: getVal('inp-partners'),
                compDirect: getVal('inp-comp-direct'),
                compIndirect: getVal('inp-comp-indirect'),
                history: getVal('inp-history'),
                jobs: getVal('inp-jobs'),
                events: getVal('inp-events'),
                updated: new Date().toLocaleDateString()
            };

            const idx = db.findIndex(x => x.id === record.id);
            if(idx > -1) db[idx] = record;
            else db.push(record);

            localStorage.setItem('pmo_ent_db', JSON.stringify(db));
            document.getElementById('main-form').reset();
            nav('dashboard');
            renderTable();
        });

        function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            db.forEach(c => {
                const tr = document.createElement('tr');
                tr.className = "border-b hover:bg-gray-50";
                tr.innerHTML = `
                    <td class="px-6 py-4 font-bold text-corp-900">${c.name}</td>
                    <td class="px-6 py-4 text-gray-500">${c.industry}</td>
                    <td class="px-6 py-4 text-green-600 font-mono">${c.revenue}</td>
                    <td class="px-6 py-4 text-right space-x-2">
                        <button onclick="loadRec('${c.id}')" class="text-blue-600 hover:underline">Edit</button>
                        <button onclick="exportPPT('${c.id}')" class="text-orange-600 hover:underline">PPT</button>
                        <button onclick="deleteRec('${c.id}')" class="text-red-400 hover:underline">Del</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function loadRec(id) {
            const r = db.find(x => x.id === id);
            if(!r) return;
            document.getElementById('entry-id').value = r.id;
            // Loop through keys and set values by matching inp-{key} (simplified for brevity)
            const map = {
                'inp-name': r.name, 'inp-industry': r.industry, 'inp-web': r.website,
                'inp-hq': r.hq, 'inp-rev': r.revenue, 'inp-ceo': r.ceo, 'inp-desc': r.desc,
                'inp-products': r.products, 'inp-tech': r.tech, 'inp-acq': r.acq,
                'inp-partners': r.partners, 'inp-comp-direct': r.compDirect,
                'inp-comp-indirect': r.compIndirect, 'inp-history': r.history,
                'inp-jobs': r.jobs, 'inp-events': r.events
            };
            for(let k in map) { if(document.getElementById(k)) document.getElementById(k).value = map[k] || ''; }
            nav('analyze');
        }

        function deleteRec(id) {
            if(confirm("Delete record?")) {
                db = db.filter(x => x.id !== id);
                localStorage.setItem('pmo_ent_db', JSON.stringify(db));
                renderTable();
            }
        }

        function backupData() {
            const blob = new Blob([JSON.stringify(db, null, 2)], {type: "application/json"});
            saveAs(blob, "PMO_Enterprise_Backup.json");
        }

        // --- EXPORT: ENTERPRISE PPT ---
        function exportPPT(id) {
            const r = db.find(x => x.id === id);
            let pptx = new PptxGenJS();
            pptx.layout = 'LAYOUT_16x9';

            // Master Design
            pptx.defineSlideMaster({
                title: 'MASTER',
                background: { color: 'F1F5F9' },
                objects: [
                    { rect: { x: 0, y: 0, w: '100%', h: 0.6, fill: '0F172A' } },
                    { text: { text: r.name + " | Corporate Analysis", options: { x: 0.5, y: 0.1, color: 'FFFFFF', bold: true } } },
                    { text: { text: "CONFIDENTIAL", options: { x: 11, y: 0.1, color: 'CBD5E1', fontSize: 10 } } }
                ]
            });

            // Slide 1: Title
            let s1 = pptx.addSlide({ masterName: 'MASTER' });
            s1.addText(r.name, { x: 1, y: 2.5, fontSize: 40, bold: true, color: '1E293B' });
            s1.addText(r.industry + " | " + r.revenue, { x: 1, y: 3.5, fontSize: 18, color: '64748B' });
            s1.addText("Headquarters: " + r.hq, { x: 1, y: 4, fontSize: 14, color: '64748B' });

            // Slide 2: Overview & Tech
            let s2 = pptx.addSlide({ masterName: 'MASTER' });
            s2.addText("Overview & Technology", { x: 0.5, y: 0.8, fontSize: 20, bold: true, color: '1E293B' });
            s2.addText("Description:", { x: 0.5, y: 1.5, fontSize: 12, bold: true });
            s2.addText(r.desc, { x: 0.5, y: 1.8, w: 5, fontSize: 11, color: '333333' });
            
            s2.addText("Technology Stack:", { x: 6, y: 1.5, fontSize: 12, bold: true });
            s2.addText(r.tech, { x: 6, y: 1.8, w: 6, fontSize: 11, color: '333333', fill: 'E2E8F0' });

            // Slide 3: Ecosystem (Partners & Acquisitions)
            let s3 = pptx.addSlide({ masterName: 'MASTER' });
            s3.addText("Business Ecosystem", { x: 0.5, y: 0.8, fontSize: 20, bold: true, color: '1E293B' });
            
            s3.addText("Key Acquisitions", { x: 0.5, y: 1.5, fontSize: 14, color: '2563EB', bold: true });
            s3.addText(r.acq, { x: 0.5, y: 2, w: 5, fontSize: 11 });

            s3.addText("Strategic Partnerships", { x: 6.5, y: 1.5, fontSize: 14, color: '2563EB', bold: true });
            s3.addText(r.partners, { x: 6.5, y: 2, w: 5, fontSize: 11 });

            // Slide 4: Competition
            let s4 = pptx.addSlide({ masterName: 'MASTER' });
            s4.addText("Competitive Landscape", { x: 0.5, y: 0.8, fontSize: 20, bold: true, color: '1E293B' });
            
            s4.addTable([
                [{ text: "Direct Competitors", options: { fill: 'EF4444', color: 'FFFFFF', bold: true } }, { text: "Indirect Competitors", options: { fill: 'F59E0B', color: 'FFFFFF', bold: true } }],
                [r.compDirect, r.compIndirect]
            ], { x: 1, y: 2, w: 11, rowH: 2, border: { pt: 1, color: 'E2E8F0' } });

            // Slide 5: Milestones
            let s5 = pptx.addSlide({ masterName: 'MASTER' });
            s5.addText("Key Milestones & History", { x: 0.5, y: 0.8, fontSize: 20, bold: true, color: '1E293B' });
            s5.addText(r.history, { x: 0.5, y: 1.5, w: 12, fontSize: 10, fontFace: 'Courier New', color: '333333' });

            pptx.writeFile({ fileName: `${r.name}_Analysis_v3.pptx` });
        }
    </script>
</body>
</html>
