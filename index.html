<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PMO Master Suite | Enterprise V4</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        corp: { 50: '#f8fafc', 100: '#f1f5f9', 800: '#1e293b', 900: '#0f172a' },
                        brand: { 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; color: #1e293b; -webkit-tap-highlight-color: transparent; }
        .nav-item.active { background-color: #eff6ff; color: #2563eb; border-left: 4px solid #2563eb; }
        .hide { display: none !important; }
        .inp-std { width: 100%; padding: 0.6rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 0.825rem; outline: none; transition: all 0.2s; background: white; }
        .inp-std:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .lbl-std { font-size: 0.65rem; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 0.25rem; display: block; letter-spacing: 0.05em; }
        .card-header { border-bottom: 1px solid #f1f5f9; padding-bottom: 0.75rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; font-weight: 700; color: #334155; }
        .auth-bg { background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="h-screen overflow-hidden bg-slate-50 flex flex-col">

    <div id="auth-layer" class="fixed inset-0 z-50 bg-white flex items-center justify-center auth-bg">
        <div class="w-full max-w-md p-8 bg-white shadow-2xl rounded-2xl border border-gray-100 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-indigo-600"></div>
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold tracking-tight text-corp-900">PMO<span class="text-brand-600">Master</span></h1>
                <p class="text-[10px] text-gray-500 mt-2 font-bold tracking-widest uppercase">Intelligenze V4 Production</p>
            </div>
            <div id="form-login" class="space-y-4">
                <div><label class="lbl-std">Username</label><input type="text" id="login-user" class="inp-std" placeholder="admin / analyst"></div>
                <div><label class="lbl-std">Password</label><input type="password" id="login-pass" class="inp-std" placeholder="••••••••"></div>
                <button onclick="authLogin()" class="w-full bg-corp-900 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-gray-800 transition">Secure Sign In</button>
                <div class="flex items-center justify-between pt-4 border-t border-gray-100">
                    <button onclick="toggleAuth('signup')" class="text-xs text-brand-600 font-bold hover:underline">Register</button>
                    <button onclick="toggleAuth('guest')" class="text-xs text-gray-400 hover:text-gray-600 font-medium"><i class="fas fa-key mr-1"></i> Use Guest Pass</button>
                </div>
            </div>
            <div id="form-guest" class="space-y-4 hide">
                <div><label class="lbl-std">Guest Pass Key</label><input type="text" id="guest-token" class="inp-std font-mono text-center tracking-widest" placeholder="XXXX-XXXX"></div>
                <button onclick="authGuestToken()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold">Access Dashboard</button>
                <div class="text-center pt-2"><button onclick="toggleAuth('login')" class="text-xs text-gray-500">Back to Login</button></div>
            </div>
            <div id="form-signup" class="space-y-4 hide">
                <div><label class="lbl-std">Username</label><input type="text" id="sign-user" class="inp-std"></div>
                <div><label class="lbl-std">Role</label><select id="sign-role" class="inp-std bg-white"><option value="analyst">Analyst</option><option value="admin">Admin</option></select></div>
                <div><label class="lbl-std">Password</label><input type="password" id="sign-pass" class="inp-std"></div>
                <button onclick="authSignup()" class="w-full bg-brand-600 text-white py-3 rounded-lg font-bold">Register User</button>
                <div class="text-center pt-2"><button onclick="toggleAuth('login')" class="text-xs text-gray-500">Back</button></div>
            </div>
        </div>
    </div>

    <div id="app-layer" class="flex-1 flex flex-col md:flex-row h-full overflow-hidden opacity-0 transition-opacity duration-500">
        <aside class="w-64 bg-white border-r border-gray-200 hidden md:flex flex-col z-20 shadow-lg">
            <div class="p-6 border-b border-gray-100">
                <h1 class="text-xl font-bold tracking-tight text-corp-900">PMO<span class="text-brand-600">Master</span></h1>
                <div class="flex items-center mt-3 gap-2 bg-gray-50 px-2 py-1 rounded border border-gray-100 w-fit">
                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    <p class="text-[10px] text-gray-600 font-bold tracking-wider uppercase" id="role-badge">GUEST</p>
                </div>
            </div>
            <nav class="flex-1 overflow-y-auto py-4 space-y-1">
                <a onclick="nav('dashboard')" id="nav-dashboard" class="nav-item active flex items-center px-6 py-3 text-sm font-medium cursor-pointer text-gray-600 hover:bg-gray-50 transition"><i class="fas fa-th-large w-6"></i> Dashboard</a>
                <a onclick="nav('analyze')" id="nav-analyze" class="nav-item flex items-center px-6 py-3 text-sm font-medium cursor-pointer text-gray-600 hover:bg-gray-50 transition"><i class="fas fa-search-dollar w-6"></i> Research & Edit</a>
                <a onclick="nav('visualize')" id="nav-visualize" class="nav-item flex items-center px-6 py-3 text-sm font-medium cursor-pointer text-gray-600 hover:bg-gray-50 transition"><i class="fas fa-chart-pie w-6"></i> Analytics</a>
                <a onclick="nav('settings')" id="nav-settings" class="nav-item flex items-center px-6 py-3 text-sm font-medium cursor-pointer text-gray-600 hover:bg-gray-50 transition"><i class="fas fa-cog w-6"></i> Settings</a>
            </nav>
            <div class="p-4 border-t border-gray-200">
                 <button onclick="logout()" class="w-full text-xs text-red-500 border border-red-100 bg-red-50 py-2.5 rounded hover:bg-red-100 font-semibold flex items-center justify-center gap-2"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col h-full overflow-hidden relative w-full bg-slate-50">
            <header class="hidden md:flex h-16 bg-white border-b border-gray-200 items-center justify-between px-8 shrink-0 shadow-sm z-10">
                <h2 id="page-title" class="text-lg font-bold text-gray-800">Dashboard</h2>
                <div class="flex items-center space-x-3 text-sm">
                    <div class="text-right leading-tight">
                        <div class="font-semibold text-gray-800" id="display-user">Guest</div>
                        <div class="text-[10px] text-gray-400">Authenticated</div>
                    </div>
                    <i class="fas fa-user-circle text-3xl text-gray-300"></i>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 md:p-8" id="main-scroll">
                
                <div id="view-dashboard" class="space-y-6 max-w-7xl mx-auto">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
                            <div class="text-[10px] text-gray-400 font-bold uppercase">Total Companies</div>
                            <div class="text-3xl font-bold text-corp-900 mt-1" id="kpi-count">0</div>
                        </div>
                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
                            <div class="text-[10px] text-gray-400 font-bold uppercase">Total Valuation</div>
                            <div class="text-3xl font-bold text-green-600 mt-1" id="kpi-val">$0</div>
                        </div>
                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
                            <div class="text-[10px] text-gray-400 font-bold uppercase">Data Points</div>
                            <div class="text-3xl font-bold text-blue-600 mt-1" id="kpi-points">0</div>
                        </div>
                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
                            <div class="text-[10px] text-gray-400 font-bold uppercase">System</div>
                            <div class="text-3xl font-bold text-emerald-500 mt-1 text-sm pt-1"><i class="fas fa-shield-check mr-1"></i> ACTIVE</div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                            <h3 class="font-bold text-gray-800">Intelligence Directory</h3>
                            <button id="btn-add-new" onclick="nav('analyze')" class="text-xs bg-brand-600 text-white px-4 py-2 rounded font-bold shadow-sm hover:bg-brand-700 transition"><i class="fas fa-plus mr-1"></i> New Entry</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-gray-50 text-gray-500 border-b">
                                    <tr>
                                        <th class="px-6 py-3 font-semibold">Company Name & Web</th>
                                        <th class="px-6 py-3 font-semibold">CEO / Leadership</th>
                                        <th class="px-6 py-3 font-semibold">HQ / Parent</th>
                                        <th class="px-6 py-3 font-semibold">Valuation</th>
                                        <th class="px-6 py-3 font-semibold">Analyst</th>
                                        <th class="px-6 py-3 font-semibold text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="view-analyze" class="hide max-w-6xl mx-auto pb-24">
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="lg:col-span-2 bg-white rounded-xl border border-gray-200 p-6">
                            <div class="card-header"><i class="fas fa-bolt text-yellow-500"></i> Smart Intelligence Extract</div>
                            <textarea id="paste-area" class="w-full h-32 p-3 bg-slate-50 border border-slate-200 rounded-lg text-xs outline-none focus:ring-2 focus:ring-brand-500" placeholder="Paste news article, LinkedIn bio, or raw text here..."></textarea>
                            <div class="mt-3 flex gap-2">
                                <button onclick="smartParse()" class="bg-brand-600 text-white px-4 py-2 rounded text-xs font-bold hover:bg-brand-700">Auto-Extract Data</button>
                                <button onclick="resetForm()" class="text-gray-500 px-4 py-2 text-xs font-bold border border-gray-200 rounded">Clear Form</button>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <div class="card-header"><i class="fas fa-search-plus text-blue-500"></i> OSINT Discovery</div>
                            <input type="text" id="search-input" class="inp-std mb-3" placeholder="Target Company Name">
                            <button onclick="runDiscovery()" class="w-full bg-slate-900 text-white py-2 rounded text-xs font-bold hover:bg-slate-800">Generate Research Links</button>
                            <div id="discovery-panel" class="mt-4 grid grid-cols-2 gap-2 hidden"></div>
                        </div>
                    </div>

                    <form id="main-form" class="space-y-6">
                        <input type="hidden" id="entry-id">
                        
                        <div class="bg-white rounded-xl border border-gray-200 p-6 relative">
                            <div class="card-header text-brand-600"><i class="fas fa-id-badge"></i> 1. Corporate Identity</div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div><label class="lbl-std">Company Name</label><input type="text" id="inp-name" required class="inp-std"></div>
                                <div><label class="lbl-std">Website</label><input type="text" id="inp-web" class="inp-std"></div>
                                <div><label class="lbl-std">Parent Company</label><input type="text" id="inp-parent" class="inp-std"></div>
                                <div><label class="lbl-std">HQ Location</label><input type="text" id="inp-hq" class="inp-std"></div>
                                <div><label class="lbl-std">Launch Date / Year</label><input type="text" id="inp-launch" class="inp-std"></div>
                                <div><label class="lbl-std">Valuation / Revenue</label><input type="text" id="inp-rev" class="inp-std font-bold text-green-700"></div>
                            </div>
                            <div class="mt-4"><label class="lbl-std">Founder & Current CEO</label><input type="text" id="inp-ceo" class="inp-std"></div>
                            <div class="mt-4"><label class="lbl-std">About (Mission/Vision)</label><textarea id="inp-desc" rows="2" class="inp-std"></textarea></div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <div class="card-header text-emerald-600"><i class="fas fa-cubes"></i> 2. Portfolio & Market</div>
                                <div class="space-y-4">
                                    <div><label class="lbl-std">Key Products / Services</label><textarea id="inp-products" rows="3" class="inp-std"></textarea></div>
                                    <div><label class="lbl-std">What makes it a Player? (USP)</label><textarea id="inp-usp" rows="2" class="inp-std"></textarea></div>
                                    <div><label class="lbl-std">Market Coverage (Countries)</label><input type="text" id="inp-market" class="inp-std"></div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <div class="card-header text-purple-600"><i class="fas fa-sitemap"></i> 3. Structure & Tech</div>
                                <div class="space-y-4">
                                    <div><label class="lbl-std">Subsidiaries / Acquisitions</label><textarea id="inp-sub" rows="3" class="inp-std"></textarea></div>
                                    <div><label class="lbl-std">Partnerships & Tech Stack</label><textarea id="inp-tech" rows="3" class="inp-std"></textarea></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <div class="card-header text-orange-600"><i class="fas fa-users-cog"></i> 4. Org Chart & Strategic Contacts</div>
                            <div class="bg-slate-50 p-2 rounded text-[10px] text-gray-500 mb-3"><i class="fas fa-info-circle"></i> Format: [Name | Designation | Persona (Decision Maker?) | Recent Activity]</div>
                            <textarea id="inp-orgchart" rows="6" class="inp-std font-mono" placeholder="Ex: Harsha | CEO | Decision Maker | Recently launched AI initiative"></textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <div class="card-header text-red-600"><i class="fas fa-swords"></i> 5. Competitive Landscape</div>
                                <div class="space-y-4">
                                    <div><label class="lbl-std">Client Competitors</label><textarea id="inp-comp-client" rows="2" class="inp-std"></textarea></div>
                                    <div><label class="lbl-std">iOPEX vs Client Advantage</label><textarea id="inp-comp-iopex" rows="2" class="inp-std"></textarea></div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <div class="card-header text-blue-600"><i class="fas fa-calendar-alt"></i> 6. Events & Hiring</div>
                                <div class="space-y-4">
                                    <div><label class="lbl-std">Event Calendar (Conferences/PR)</label><textarea id="inp-events" rows="2" class="inp-std"></textarea></div>
                                    <div><label class="lbl-std">Recent Openings / Talent Gaps</label><textarea id="inp-hiring" rows="2" class="inp-std"></textarea></div>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between sticky bottom-4 bg-white p-4 rounded-xl shadow-2xl border border-gray-200 z-20">
                            <button type="button" onclick="nav('dashboard')" class="text-sm text-gray-400 font-bold hover:text-gray-800">DISCARD</button>
                            <button type="submit" class="bg-corp-900 text-white px-12 py-3 rounded-lg font-bold shadow-lg hover:scale-105 transform transition">
                                <i class="fas fa-cloud-upload mr-2"></i> SYNC INTELLIGENCE
                            </button>
                        </div>
                    </form>
                </div>

                <div id="view-settings" class="hide max-w-2xl mx-auto space-y-6">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Share Control</h3>
                        <div class="space-y-4">
                            <div><label class="lbl-std">Token Expiration</label><input type="datetime-local" id="share-custom-date" class="inp-std"></div>
                            <button onclick="generateToken()" class="w-full bg-blue-600 text-white py-3 rounded font-bold">Generate New Guest Pass</button>
                            <div id="token-display" class="hidden bg-slate-50 p-4 rounded-lg border border-dashed border-slate-300 animate-fade">
                                <div class="text-center font-mono text-xl font-bold tracking-widest mb-2" id="gen-code"></div>
                                <div class="flex gap-2">
                                    <input type="text" id="gen-link" class="flex-1 text-[10px] p-2 bg-white border" readonly>
                                    <button onclick="copyLink()" class="bg-gray-200 px-3 text-xs font-bold">Copy</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="admin-zone" class="bg-white p-8 rounded-xl shadow-sm border border-red-100 hidden">
                        <h4 class="font-bold text-red-600 mb-2 uppercase text-xs">Admin Force Control</h4>
                        <button onclick="clearAllData()" class="w-full text-xs text-red-500 border border-red-200 py-3 rounded hover:bg-red-50 font-bold">WIPE ENTIRE DATABASE</button>
                    </div>
                </div>

                <div id="view-visualize" class="hide max-w-6xl mx-auto">
                    <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h3 class="font-bold text-gray-800 mb-6">Valuation Trends</h3>
                        <div class="h-96 w-full"><canvas id="chart-valuation"></canvas></div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <div id="view-modal" class="fixed inset-0 z-50 bg-slate-900/60 hidden flex justify-end">
        <div class="w-full max-w-3xl h-full bg-white shadow-2xl overflow-y-auto relative p-0">
            <div class="sticky top-0 bg-white/95 backdrop-blur border-b p-6 flex justify-between items-center z-10 shadow-sm">
                <div>
                    <h2 id="vm-name" class="text-2xl font-black text-corp-900">Company Name</h2>
                    <div class="flex gap-4 text-[10px] mt-1 font-bold text-gray-400 uppercase tracking-widest">
                        <span id="vm-parent">Parent</span> | <span id="vm-hq">Location</span>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button id="vm-btn-edit" class="bg-brand-600 text-white px-4 py-2 rounded text-xs font-bold hover:bg-brand-700">EDIT INTEL</button>
                    <button onclick="closeModal()" class="text-slate-400 hover:text-slate-900 px-2 text-2xl">&times;</button>
                </div>
            </div>
            
            <div class="p-8 space-y-10">
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <div class="text-[10px] font-black text-gray-400 uppercase mb-1">CEO</div>
                        <div id="vm-ceo" class="text-sm font-bold text-slate-800">-</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-[10px] font-black text-green-600 uppercase mb-1">Valuation</div>
                        <div id="vm-rev" class="text-sm font-bold text-green-700">-</div>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <div class="text-[10px] font-black text-gray-400 uppercase mb-1">Launched</div>
                        <div id="vm-launch" class="text-sm font-bold text-slate-800">-</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <section>
                        <h4 class="text-xs font-black text-brand-600 uppercase border-b border-brand-100 pb-2 mb-4">Strategic Overview</h4>
                        <div id="vm-desc" class="text-xs text-slate-600 leading-relaxed mb-4"></div>
                        <div class="space-y-3">
                            <div><span class="text-[10px] font-bold text-slate-400 block uppercase">USP</span><p id="vm-usp" class="text-xs text-slate-800 font-medium"></p></div>
                            <div><span class="text-[10px] font-bold text-slate-400 block uppercase">Market Coverage</span><p id="vm-market" class="text-xs text-slate-800 font-medium"></p></div>
                        </div>
                    </section>
                    <section>
                        <h4 class="text-xs font-black text-emerald-600 uppercase border-b border-emerald-100 pb-2 mb-4">Portfolio & Ecosystem</h4>
                        <div class="space-y-3">
                            <div><span class="text-[10px] font-bold text-emerald-500 block uppercase">Key Products</span><p id="vm-products" class="text-xs text-slate-800 whitespace-pre-line"></p></div>
                            <div><span class="text-[10px] font-bold text-emerald-500 block uppercase">Subsidiaries</span><p id="vm-sub" class="text-xs text-slate-800 whitespace-pre-line"></p></div>
                        </div>
                    </section>
                </div>

                <section class="bg-slate-900 rounded-xl p-6 text-slate-100">
                    <h4 class="text-xs font-black text-blue-400 uppercase mb-4 tracking-widest"><i class="fas fa-microchip mr-2"></i> Tech & Partnerships</h4>
                    <p id="vm-tech" class="text-xs text-slate-300 whitespace-pre-line leading-relaxed"></p>
                </section>

                <section>
                    <h4 class="text-xs font-black text-orange-600 uppercase border-b border-orange-100 pb-2 mb-4">Org Chart / Contacts</h4>
                    <div id="vm-orgchart" class="bg-slate-50 p-4 rounded-lg font-mono text-xs text-slate-700 whitespace-pre-line"></div>
                </section>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <section>
                        <h4 class="text-xs font-black text-red-600 uppercase border-b border-red-100 pb-2 mb-4">Competitors</h4>
                        <div class="space-y-3">
                            <div><span class="text-[10px] font-bold text-red-400 block uppercase">Client Side</span><p id="vm-comp-client" class="text-xs text-slate-800"></p></div>
                            <div><span class="text-[10px] font-bold text-red-400 block uppercase">iOPEX Edge</span><p id="vm-comp-iopex" class="text-xs text-slate-800"></p></div>
                        </div>
                    </section>
                    <section>
                        <h4 class="text-xs font-black text-blue-600 uppercase border-b border-blue-100 pb-2 mb-4">Intel Pipeline</h4>
                        <div class="space-y-3">
                            <div><span class="text-[10px] font-bold text-blue-400 block uppercase">Event Calendar</span><p id="vm-events" class="text-xs text-slate-800"></p></div>
                            <div><span class="text-[10px] font-bold text-blue-400 block uppercase">Recent Openings</span><p id="vm-hiring" class="text-xs text-slate-800"></p></div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('pmo_master_db')) || [];
        let users = JSON.parse(localStorage.getItem('pmo_users')) || [{ user: 'admin', pass: 'admin', role: 'admin' }];
        let validTokens = JSON.parse(localStorage.getItem('pmo_tokens')) || [];
        let session = null;

        // AUTH
        function toggleAuth(v) { document.getElementById('form-login').classList.add('hide'); document.getElementById('form-guest').classList.add('hide'); document.getElementById('form-signup').classList.add('hide'); document.getElementById(`form-${v}`).classList.remove('hide'); }
        function authLogin() { const u = document.getElementById('login-user').value, p = document.getElementById('login-pass').value; const v = users.find(x=>x.user===u&&x.pass===p); if(v) startSession(v); else alert("Try admin/admin"); }
        function authSignup() { const u = document.getElementById('sign-user').value, p = document.getElementById('sign-pass').value, r = document.getElementById('sign-role').value; if(users.find(x=>x.user===u)) return alert("Exists"); const n = {user:u,pass:p,role:r}; users.push(n); localStorage.setItem('pmo_users',JSON.stringify(users)); startSession(n); }
        function authGuestToken() { const t = document.getElementById('guest-token').value; const m = validTokens.find(x=>x.code===t&&(x.exp===0||x.exp>Date.now())); if(m) startSession({user:'Guest',role:'guest'}); else alert("Invalid Token"); }
        function startSession(u) { session = u; document.getElementById('auth-layer').classList.add('hide'); document.getElementById('app-layer').classList.remove('opacity-0'); document.getElementById('display-user').innerText = session.user; document.getElementById('role-badge').innerText = session.role.toUpperCase(); if(session.role==='admin') document.getElementById('admin-zone').classList.remove('hidden'); if(session.role==='guest') { document.getElementById('nav-analyze').classList.add('hide'); document.getElementById('btn-add-new').classList.add('hide'); } renderTable(); updateKPIs(); nav('dashboard'); }
        function logout() { location.reload(); }

        // NAVIGATION
        function nav(id) { document.querySelectorAll('[id^="view-"]').forEach(e=>e.classList.add('hide')); document.getElementById(`view-${id}`).classList.remove('hide'); document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active')); const l = document.getElementById(`nav-${id}`); if(l) l.classList.add('active'); if(id==='visualize') renderChart(); }
        function closeModal() { document.getElementById('view-modal').classList.add('hidden'); }

        // DATA OPS
        function renderTable() {
            const b = document.getElementById('table-body'); b.innerHTML = '';
            db.forEach(r => {
                const canEdit = session.role === 'admin' || r.author === session.user;
                const tr = document.createElement('tr');
                tr.className = "border-b hover:bg-slate-50 transition cursor-pointer";
                tr.onclick = (e) => { if(!e.target.closest('button')) openViewModal(r.id); };
                tr.innerHTML = `
                    <td class="px-6 py-4"><div class="font-bold text-slate-900">${r.name}</div><div class="text-[10px] text-blue-500 font-bold">${r.web || '-'}</div></td>
                    <td class="px-6 py-4 text-xs font-semibold text-slate-600">${r.ceo || '-'}</td>
                    <td class="px-6 py-4 text-[10px]"><div class="font-bold text-slate-800">${r.hq || '-'}</div><div class="text-slate-400">${r.parent || '-'}</div></td>
                    <td class="px-6 py-4 text-xs font-bold text-emerald-600">${r.rev || '-'}</td>
                    <td class="px-6 py-4 text-[10px] font-bold text-slate-400">${r.author}</td>
                    <td class="px-6 py-4 text-right">
                        <div class="flex justify-end gap-1">
                            ${canEdit ? `<button onclick="edit('${r.id}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded"><i class="fas fa-edit"></i></button>` : ''}
                            <button onclick="exportPPT('${r.id}')" class="p-2 text-orange-500 hover:bg-orange-50 rounded"><i class="fas fa-file-powerpoint"></i></button>
                            ${canEdit ? `<button onclick="del('${r.id}')" class="p-2 text-red-400 hover:bg-red-50 rounded"><i class="fas fa-trash"></i></button>` : ''}
                        </div>
                    </td>`;
                b.appendChild(tr);
            });
        }

        // SMART PARSE (Regex AI-Lite)
        function smartParse() {
            const text = document.getElementById('paste-area').value;
            const patterns = {
                'inp-name': [/Company:\s*(.*)/i, /Name:\s*(.*)/i],
                'inp-ceo': [/CEO:\s*(.*)/i, /CEO is\s*(.*)/i, /founder\s*(.*)/i],
                'inp-hq': [/Headquarters:\s*(.*)/i, /HQ:\s*(.*)/i, /located in\s*(.*)/i],
                'inp-launch': [/launched in\s*(\d{4})/i, /founded in\s*(\d{4})/i, /Date:\s*(.*)/i],
                'inp-rev': [/valuation of\s*(.*)/i, /Revenue:\s*(.*)/i, /worth\s*(.*)/i]
            };
            for (let id in patterns) {
                for (let reg of patterns[id]) {
                    let m = text.match(reg);
                    if (m && m[1]) { document.getElementById(id).value = m[1].split('.')[0].trim(); break; }
                }
            }
        }

        // DISCOVERY
        function runDiscovery() {
            const n = document.getElementById('search-input').value; if(!n) return;
            const p = document.getElementById('discovery-panel'); p.classList.remove('hidden'); p.innerHTML = '';
            const links = [
                {t:"LinkedIn", q:`site:linkedin.com/company "${n}"`},
                {t:"Org Chart", q:`site:theorg.com "${n}"`},
                {t:"Tech Stack", q:`site:builtwith.com "${n}"`},
                {t:"Financials", q:`"${n}" annual revenue 2026 valuation`},
                {t:"Competitors", q:`top competitors for "${n}" digital marketing`},
                {t:"Hiring", q:`site:glassdoor.com "${n}" careers`}
            ];
            links.forEach(l => {
                const a = document.createElement('a'); a.href=`https://www.google.com/search?q=${encodeURIComponent(l.q)}`; a.target="_blank";
                a.className = "p-2 bg-slate-50 border rounded text-[10px] font-bold text-center hover:bg-white transition";
                a.innerText = l.t; p.appendChild(a);
            });
        }

        // FORM SUBMIT
        document.getElementById('main-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const get = (i) => document.getElementById(i).value;
            const rec = {
                id: document.getElementById('entry-id').value || Date.now().toString(),
                author: session.user, updated: new Date().toLocaleDateString(),
                name: get('inp-name'), web: get('inp-web'), parent: get('inp-parent'), hq: get('inp-hq'), launch: get('inp-launch'), rev: get('inp-rev'), ceo: get('inp-ceo'), desc: get('inp-desc'),
                products: get('inp-products'), usp: get('inp-usp'), market: get('inp-market'), sub: get('inp-sub'), tech: get('inp-tech'),
                orgchart: get('inp-orgchart'), comp_client: get('inp-comp-client'), comp_iopex: get('inp-comp-iopex'), events: get('inp-events'), hiring: get('inp-hiring')
            };
            const idx = db.findIndex(x=>x.id===rec.id);
            if(idx>-1) db[idx] = rec; else db.push(rec);
            localStorage.setItem('pmo_master_db', JSON.stringify(db));
            resetForm(); nav('dashboard'); renderTable(); updateKPIs();
        });

        function edit(id) { const r = db.find(x=>x.id===id); document.getElementById('entry-id').value = r.id; for(let k in r) { const el = document.getElementById(`inp-${k}`); if(el) el.value = r[k] || ''; } nav('analyze'); }
        function del(id) { if(confirm("Delete?")) { db = db.filter(x=>x.id!==id); localStorage.setItem('pmo_master_db', JSON.stringify(db)); renderTable(); updateKPIs(); } }
        function resetForm() { document.getElementById('main-form').reset(); document.getElementById('entry-id').value=''; }
        function openViewModal(id) { 
            const r = db.find(x=>x.id===id); 
            for(let k in r) { const el = document.getElementById(`vm-${k}`); if(el) el.innerText = r[k] || '-'; } 
            const b = document.getElementById('vm-btn-edit'); 
            if(session.role==='admin'||r.author===session.user) { b.classList.remove('hide'); b.onclick=()=>{closeModal(); edit(r.id);}; } else b.classList.add('hide');
            document.getElementById('view-modal').classList.remove('hidden'); 
        }

        function updateKPIs() { 
            document.getElementById('kpi-count').innerText = db.length; 
            document.getElementById('kpi-points').innerText = db.length * 18; 
            let t = 0; db.forEach(r=>{if(r.rev){ let n = parseFloat(r.rev.replace(/[^0-9.]/g,'')); if(!isNaN(n)) t+= r.rev.includes('B')?n*1000:n; }});
            document.getElementById('kpi-val').innerText = t>=1000?`$${(t/1000).toFixed(1)}B`:`$${t}M`;
        }

        function generateToken() { const d = document.getElementById('share-custom-date').value; const c = Math.random().toString(36).substring(7).toUpperCase(); const exp = d?new Date(d).getTime():0; validTokens.push({code:c, exp:exp, by:session.user}); localStorage.setItem('pmo_tokens',JSON.stringify(validTokens)); document.getElementById('token-display').classList.remove('hidden'); document.getElementById('gen-code').innerText=c; document.getElementById('gen-link').value=`${location.href}?key=${c}`; }
        function copyLink() { const i = document.getElementById('gen-link'); i.select(); document.execCommand('copy'); alert('Copied'); }
        function clearAllData() { if(confirm("Wipe Everything?")) { localStorage.clear(); location.reload(); } }
        function backupData() { saveAs(new Blob([JSON.stringify({db,users,validTokens})],{type:"application/json"}), "PMO_Master_Backup.json"); }

        function renderChart() {
            const ctx = document.getElementById('chart-valuation').getContext('2d');
            const vals = db.map(r=>{ let n = parseFloat((r.rev||"0").replace(/[^0-9.]/g,'')); return r.rev&&r.rev.includes('B')?n*1000:n; });
            if(window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, { type: 'bar', data: { labels: db.map(x=>x.name), datasets: [{label:'Value (Millions)', data:vals, backgroundColor:'#3b82f6'}]}, options: {responsive:true, maintainAspectRatio:false}});
        }
    </script>
</body>
</html>
